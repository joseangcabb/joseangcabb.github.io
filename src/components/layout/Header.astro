---
import type { NavItem } from '@/types/site'
import Icon from '@/components/ui/Icon.astro'

interface Props {
  logo: string
  navItems: NavItem[]
}

const { logo, navItems } = Astro.props
---

<header
  class="fixed top-0 right-0 left-0 z-50 border-b border-slate-200 bg-transparent p-3 transition-all duration-300"
>
  <div class="mx-auto flex max-w-5xl items-center justify-between">
    <a href="/" class="flex items-center gap-x-2">
      <Icon name="code" className="size-8 stroke-[2] text-slate-600" />
      <span class="text-3xl font-bold text-slate-800">{logo}</span>
    </a>
    <nav class="hidden md:block">
      <ul class="flex items-center gap-x-8">
        {
          navItems.map((item) => (
            <li>
              <a href={item.href} class={`flex items-center gap-2 ${item.variant}`}>
                {item.icon && <Icon name={item.icon} className="size-6" />}
                {item.label}
              </a>
            </li>
          ))
        }
      </ul>
    </nav>
    <button
      id="menu-btn"
      aria-expanded="false"
      aria-label="Toggle menu"
      class="cursor-pointer rounded-lg p-2 transition hover:bg-slate-100 md:hidden"
    >
      <span id="menu-icon-bars">
        <Icon name="bars" className="size-8 text-slate-700" />
      </span>
      <span id="menu-icon-x" class="hidden">
        <Icon name="x" className="size-8 text-slate-700" />
      </span>
    </button>
  </div>

  <nav
    id="mobile-nav"
    class="max-h-0 overflow-hidden transition-[max-height] duration-300 md:hidden"
  >
    <ul class="flex flex-col gap-y-4 px-4 py-4">
      {
        navItems.map((item) => (
          <li>
            <a href={item.href} class={`flex items-center gap-2 px-2 ${item.variant}`}>
              {item.icon && <Icon name={item.icon} className="size-6" />}
              {item.label}
            </a>
          </li>
        ))
      }
    </ul>
  </nav>
</header>

<script>
  const header = document.querySelector('header')
  const menuBtn = document.getElementById('menu-btn')
  const mobileNav = document.getElementById('mobile-nav')
  const iconBars = document.getElementById('menu-icon-bars')
  const iconX = document.getElementById('menu-icon-x')
  const navLinks = mobileNav?.querySelectorAll('a') ?? []
  let navOpen = false

  const updateHeaderState = () => {
    if (!header) return
    header.classList.toggle('is-translucent', navOpen || window.scrollY > 10)
  }

  const toggleIcons = (isOpen = false) => {
    if (iconBars) iconBars.classList.toggle('hidden', isOpen)
    if (iconX) iconX.classList.toggle('hidden', !isOpen)
  }

  const toggleNav = (forcedState?: boolean) => {
    if (!menuBtn || !mobileNav) return

    const isOpen = menuBtn.getAttribute('aria-expanded') === 'true'
    const nextState = typeof forcedState === 'boolean' ? forcedState : !isOpen

    if (isOpen === nextState) return

    menuBtn.setAttribute('aria-expanded', String(nextState))
    mobileNav.style.maxHeight = nextState ? `${mobileNav.scrollHeight}px` : '0px'

    toggleIcons(nextState)
    navOpen = nextState
    updateHeaderState()
  }

  if (menuBtn) menuBtn.addEventListener('click', () => toggleNav())

  navLinks.forEach((link) => {
    link.addEventListener('click', (e) => {
      if (!navOpen) return

      e.preventDefault()

      toggleNav(false)

      const href = link.getAttribute('href')
      if (!href) return

      setTimeout(() => {
        window.location.href = href
      }, 300)
    })
  })

  window.addEventListener('scroll', updateHeaderState, { passive: true })
  updateHeaderState()
</script>
